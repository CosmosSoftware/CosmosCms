@model Cosmos.Cms.Common.Models.ArticleViewModel
@{
    Layout = null;
    ViewData["Title"] = Model.Title;
}
<!DOCTYPE HTML>
<html lang="@Model.LanguageCode">
<head>
    <title>@Model.Title</title>
    <!--
        CK Editor styles
    -->
    @Html.Raw(Model.Layout.Head)
    @*
    Page specific header
    *@
    @Html.Raw(Model.HeadJavaScript)
    @*
    Application Insights Scripts
    *@
    @Html.Raw(JavaScriptSnippet.FullScript)
</head>
<body>
    @Html.Raw(Model.Layout.HtmlHeader)
    <div ccms-content-id="@Model.Id">
        @Html.Raw(Model.Content)
    </div>
    @Html.Raw(Model.Layout.FooterHtmlContent)
    @*
    Page specific
    *@
    @Html.Raw(Model.FooterJavaScript)

    <script src="/lib/ckeditor/build_20221113.01/ckeditor.js"></script>
    <script>

        // Create editors
        var editors = [];
        var editorIds = [];
        var editibleAreas = [];
        var unmoutCkBox;
        const HTTP_SERVER_LAG = 1500;

        document.addEventListener("DOMContentLoaded", function (event) {
            createEditors();
        });

        function createEditors() {

            const inlineInjectElements = document.querySelectorAll('[data-ccms-ceid]');

            Array.from(inlineInjectElements).forEach(inlineElement => {

                const config = {
                    toolbar: {},
                    licenseKey: '',
                    autosave: {
                        save(editor) {
                            return saveEditorChanges(editor);
                        }
                    },
                    simpleUpload: {
                        // The URL that the images are uploaded to.
                        uploadUrl: '/FileManager/SimpleUpload/@Model.ArticleNumber',
                        // Enable the XMLHttpRequest.withCredentials property.
                        withCredentials: true
                    }
                };

                if (inlineElement.tagName.toLowerCase() == 'header') {
                    config.removePlugins = [
                        'Alignment',
                        'Autoformat',
                        'AutoImage',
                        'AutoLink',
                        'BlockQuote',
                        'Bold',
                        'CloudServices',
                        'CodeBlock',
                        'Essentials',
                        'FindAndReplace',
                        'FontColor',
                        'FontSize',
                        'Highlight',
                        'HorizontalLine',
                        'Image',
                        'ImageCaption',
                        'ImageInsert',
                        'ImageResize',
                        'ImageStyle',
                        'ImageToolbar',
                        'ImageUpload',
                        'Indent',
                        'IndentBlock',
                        'Italic',
                        'LinkImage',
                        'List',
                        'ListProperties',
                        'MediaEmbed',
                        'MediaEmbedToolbar',
                        'Paragraph',
                        'PasteFromOffice',
                        'SimpleUploadAdapter',
                        'Table',
                        'TableCaption',
                        'TableCellProperties',
                        'TableColumnResize',
                        'TableProperties',
                        'TableToolbar',
                        'TextTransformation',
                        'Underline'
                    ];
                    config.toolbar.items = ['heading', '|', 'link'];
                }

                InlineEditor
                    .create(inlineElement, config)
                    .then(editor => {
                        window.editor = editor;
                        editors.push(editor);
                    })
                    .catch(error => {
                        console.error('Oops, something went wrong!');
                        console.error('Please, report the following error on https://github.com/ckeditor/ckeditor5/issues with the build id and the error stack trace:');
                        console.warn('Build id: dfs1odnc554f-b7xm83g7lami');
                        console.error(error);
                    });

            });

        }// End createEditors

        function saveEditorChanges(editor) {
            return new Promise(resolve => {
                updateArea(editor);

                if (parent.getAutoSave()) {
                    var savePromise = parent.postRegions(editibleAreas);
                }
                resolve();
            });
        }

        function updateArea(editor) {

            var sourceElement = editor.sourceElement;
            var id = sourceElement.getAttribute("data-ccms-ceid");

            if (editibleAreas.length === 0) {

                var item = { Id: id, Html: editor.getData() };

                editibleAreas.push(item);

            } else {

                var i = editibleAreas.findIndex((ed => ed.Id == id));

                if (i === -1) {
                    var item = { Id: id, Html: editor.getData() };
                    editibleAreas.push(item);

                } else {
                    editibleAreas[i].Html = editor.getData();
                }
            }
        }
    </script>
</body>
</html>